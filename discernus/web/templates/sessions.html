{% extends "base.html" %}

{% block title %}Research Sessions - Discernus{% endblock %}

{% block content %}
<div class="section">
    <h1>🔬 Research Sessions</h1>
    <p style="color: #7f8c8d; margin-bottom: 30px;">
        Complete archive of conversation-native academic research sessions with full transparency
    </p>
    
    <div id="sessions-container">
        <div class="loading">
            <div>🔬 Loading all research sessions...</div>
            <div style="font-size: 0.9rem; color: #7f8c8d; margin-top: 10px;">
                💡 First load may take 20-30 seconds while generating intelligent summaries.<br>
                Subsequent loads will be instant thanks to THIN caching.
            </div>
        </div>
    </div>
</div>

<script>
    // Load sessions with timing display
    async function loadSessions() {
        const container = document.getElementById('sessions-container');
        const startTime = Date.now();
        
        try {
            const response = await fetch('/api/sessions');
            const data = await response.json();
            
            if (data.status === 'success') {
                const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);
                
                if (data.sessions.length > 0) {
                    container.innerHTML = data.sessions.map(session => `
                        <div class="card">
                            <h3>${session.friendly_name}</h3>
                            <div class="meta">
                                📅 ${formatDate(session.timestamp)} | 
                                📁 ${session.id} | 
                                ⏱️ ${loadTime}s load time
                            </div>
                            <div class="description">
                                ${session.summary}
                            </div>
                            ${session.corpus_path ? `
                                <div class="badge">📂 ${session.corpus_path}</div>
                            ` : ''}
                            <div style="margin-top: 15px;">
                                <a href="/session/${session.id}" class="btn">📖 View Full Conversation</a>
                                <span class="badge">📁 ${session.id}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="card">
                            <h3>🚀 No completed sessions yet</h3>
                            <div class="description">
                                Start your first research session to see completed analyses here.
                                The system only shows sessions with complete conversation logs.
                            </div>
                            <a href="/new-session" class="btn">✨ Start New Research</a>
                        </div>
                    `;
                }
            } else {
                throw new Error(data.message || 'Failed to load sessions');
            }
        } catch (error) {
            console.error('Error loading sessions:', error);
            container.innerHTML = `
                <div class="error">
                    ❌ Error loading sessions: ${error.message}
                </div>
            `;
        }
    }
    
    // Load on page ready
    document.addEventListener('DOMContentLoaded', loadSessions);
</script>
{% endblock %} 