{% extends "base.html" %}

{% block title %}Research Corpora - Discernus{% endblock %}

{% block content %}
<div class="section">
    <h1>ğŸ“‚ Research Corpora</h1>
    <p style="color: #7f8c8d; margin-bottom: 30px;">
        Complete library of available text collections for conversation-native academic research
    </p>
    
    <div id="corpora-container">
        <div class="loading">
            <div>ğŸ“š Discovering available corpora...</div>
            <div style="font-size: 0.9rem; color: #7f8c8d; margin-top: 10px;">
                ğŸ’¡ First load may take 15-20 seconds while LLM analyzes corpus contents.<br>
                Subsequent loads will be instant thanks to THIN caching.
            </div>
        </div>
    </div>
</div>

<script>
    // Load corpora with timing display
    async function loadCorpora() {
        const container = document.getElementById('corpora-container');
        const startTime = Date.now();
        
        try {
            const response = await fetch('/api/corpora');
            const data = await response.json();
            
            if (data.status === 'success') {
                const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);
                
                if (data.corpora.length > 0) {
                    container.innerHTML = data.corpora.map(corpus => `
                        <div class="card">
                            <h3>${corpus.friendly_name}</h3>
                            <div class="meta">
                                ğŸ“ ${corpus.path} | 
                                ğŸ“„ ${corpus.file_count} files | 
                                â±ï¸ ${loadTime}s load time
                            </div>
                            <div class="description">
                                ${corpus.description}
                            </div>
                            ${corpus.language ? `
                                <div class="badge">ğŸŒ ${corpus.language}</div>
                            ` : ''}
                            ${corpus.time_period ? `
                                <div class="badge">ğŸ“… ${corpus.time_period}</div>
                            ` : ''}
                            ${corpus.research_themes ? `
                                <div class="badge">ğŸ¯ ${corpus.research_themes.join(', ')}</div>
                            ` : ''}
                            <div style="margin-top: 15px;">
                                <a href="/new-session?corpus=${encodeURIComponent(corpus.path)}" class="btn">ğŸš€ Start Research with this Corpus</a>
                                <button onclick="copyToClipboard('${corpus.path}')" class="btn btn-secondary">ğŸ“‹ Copy Path</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="card">
                            <h3>ğŸ“‚ No corpora discovered</h3>
                            <div class="description">
                                Add text collections to data/ or projects/ directories to make them available for research.
                            </div>
                        </div>
                    `;
                }
            } else {
                throw new Error(data.message || 'Failed to load corpora');
            }
        } catch (error) {
            console.error('Error loading corpora:', error);
            container.innerHTML = `
                <div class="error">
                    âŒ Error loading corpora: ${error.message}
                </div>
            `;
        }
    }
    
    // Load on page ready
    document.addEventListener('DOMContentLoaded', loadCorpora);
</script>
{% endblock %} 