<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }}</title>
    <style>
        /* Modern, Accessible Design System */
        :root {
            --primary-color: #2563eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --neutral-100: #f8fafc;
            --neutral-200: #e2e8f0;
            --neutral-300: #cbd5e1;
            --neutral-600: #475569;
            --neutral-800: #1e293b;
            --neutral-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.6;
            color: var(--neutral-800);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        /* Header Section */
        .header {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0;
        }

        .header .meta {
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Executive Summary - The Star of the Show */
        .executive-summary {
            padding: 40px;
            background: var(--neutral-100);
            border-bottom: 3px solid var(--primary-color);
        }

        .key-finding {
            text-align: center;
            margin-bottom: 30px;
        }

        .key-finding h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin: 0 0 10px 0;
        }

        .finding-statement {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--neutral-900);
            margin: 0 0 15px 0;
            line-height: 1.3;
        }

        .confidence-badge {
            display: inline-block;
            background: var(--success-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Traffic Light Indicators */
        .traffic-lights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .traffic-light {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .traffic-light.green {
            border-left-color: var(--success-color);
        }

        .traffic-light.yellow {
            border-left-color: var(--warning-color);
        }

        .traffic-light.red {
            border-left-color: var(--danger-color);
        }

        .traffic-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
        }

        .traffic-icon.green { background: var(--success-color); }
        .traffic-icon.yellow { background: var(--warning-color); }
        .traffic-icon.red { background: var(--danger-color); }

        .traffic-content h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: var(--neutral-900);
        }

        .traffic-content p {
            margin: 0;
            color: var(--neutral-600);
            font-size: 0.9rem;
        }

        /* What This Means Section */
        .interpretation {
            padding: 40px;
            background: white;
        }

        .interpretation h2 {
            color: var(--primary-color);
            font-size: 1.75rem;
            margin: 0 0 25px 0;
            text-align: center;
        }

        .meaning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .meaning-card {
            background: var(--neutral-100);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--neutral-200);
        }

        .meaning-card h3 {
            color: var(--primary-color);
            margin: 0 0 15px 0;
            font-size: 1.2rem;
        }

        .meaning-card p {
            margin: 0;
            color: var(--neutral-600);
            line-height: 1.6;
        }

        /* Model Comparison Cards */
        .model-comparison {
            padding: 40px;
            background: var(--neutral-50);
        }

        .model-comparison h2 {
            color: var(--primary-color);
            font-size: 1.75rem;
            margin: 0 0 30px 0;
            text-align: center;
        }

        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .model-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--neutral-200);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .model-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .model-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--neutral-200);
        }

        .model-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .model-badge {
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .centroid-display {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .centroid-display .label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .centroid-display .value {
            font-size: 1.1rem;
            font-weight: 600;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        /* Improved Statistics Section */
        .statistical-metrics {
            padding: 40px;
            background: white;
        }

        .statistical-metrics h2 {
            color: var(--primary-color);
            font-size: 1.75rem;
            margin: 0 0 30px 0;
            text-align: center;
        }

        .metric-card {
            background: var(--neutral-100);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary-color);
        }

        .metric-card h3 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin: 0 0 15px 0;
        }

        .metric-highlight {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            border: 1px solid var(--neutral-200);
        }

        .metric-explanation {
            margin-top: 15px;
            padding: 15px;
            background: #eff6ff;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }

        .metric-explanation .label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .metric-explanation .text {
            color: var(--neutral-600);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Visualization Container */
        .visualization {
            padding: 40px;
            background: var(--neutral-100);
            text-align: center;
        }

        .visualization h2 {
            color: var(--primary-color);
            font-size: 1.75rem;
            margin: 0 0 30px 0;
        }

        .plot-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            overflow-x: auto;
        }

        /* Action Items & Next Steps */
        .next-steps {
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .next-steps h2 {
            font-size: 1.75rem;
            margin: 0 0 25px 0;
            text-align: center;
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .step-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .step-item h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }

        .step-item p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .finding-statement {
                font-size: 1.4rem;
            }
            
            .executive-summary,
            .interpretation,
            .model-comparison,
            .statistical-metrics,
            .visualization,
            .next-steps {
                padding: 30px 20px;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .traffic-light,
            .model-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>{{ report_title }}</h1>
            <p class="subtitle">AI Model Comparison Study</p>
            <div class="meta">
                <p>Generated on {{ generation_date }} • Job ID: {{ job_id }}</p>
            </div>
        </div>

        <!-- Executive Summary - The Most Important Section -->
        <div class="executive-summary">
            <div class="key-finding">
                <h2>🎯 Key Finding</h2>
                {% set correlation = statistical_metrics.dimensional_correlation.correlation_matrix[0][1] if statistical_metrics.dimensional_correlation and statistical_metrics.dimensional_correlation.correlation_matrix and statistical_metrics.dimensional_correlation.correlation_matrix|length > 1 else 0 %}
                <p class="finding-statement">
                    AI models show {{ "%.1f"|format(correlation * 100) }}% correlation with small but statistically significant differences
                </p>
                <span class="confidence-badge">High Statistical Confidence</span>
            </div>

            <div class="traffic-lights">
                {% set mean_distance = statistical_metrics.geometric_similarity.mean_distance if statistical_metrics.geometric_similarity else 0 %}
                
                <div class="traffic-light green">
                    <div class="traffic-icon green">✓</div>
                    <div class="traffic-content">
                        <h3>High Correlation</h3>
                        <p>{{ "%.1f"|format(correlation * 100) }}% agreement between models</p>
                    </div>
                </div>

                <div class="traffic-light yellow">
                    <div class="traffic-icon yellow">⚠</div>
                    <div class="traffic-content">
                        <h3>Small Distance</h3>
                        <p>{{ "%.4f"|format(mean_distance) }} units difference in positioning</p>
                    </div>
                </div>

                <div class="traffic-light red">
                    <div class="traffic-icon red">!</div>
                    <div class="traffic-content">
                        <h3>Statistically Different</h3>
                        <p>Differences are real, not due to chance</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- What This Means -->
        <div class="interpretation">
            <h2>💡 What This Means</h2>
            <div class="meaning-grid">
                <div class="meaning-card">
                    <h3>For Research</h3>
                    <p>Different AI models will generally agree on moral analysis, but may have subtle systematic differences. Results are reliable for research purposes.</p>
                </div>

                <div class="meaning-card">
                    <h3>For Decision Making</h3>
                    <p>High correlation means either model could be used for analysis. Small differences suggest checking multiple models for important decisions.</p>
                </div>

                <div class="meaning-card">
                    <h3>For Methodology</h3>
                    <p>Statistical significance confirms the differences are real patterns, not random variation. This validates cross-model comparison methods.</p>
                </div>
            </div>
        </div>

        <!-- Model Comparison -->
        <div class="model-comparison">
            <h2>🤖 Model Results</h2>
            <div class="models-grid">
                {% for condition in condition_results %}
                <div class="model-card">
                    <div class="model-header">
                        <div class="model-name">{{ condition.condition_identifier }}</div>
                        <div class="model-badge">{{ comparison_type }}</div>
                    </div>
                    
                    <div class="centroid-display">
                        <div class="label">Moral Framework Position</div>
                        <div class="value">({{ "%.3f"|format(condition.centroid[0]) }}, {{ "%.3f"|format(condition.centroid[1]) }})</div>
                    </div>

                    <table class="scores-table">
                        <thead>
                            <tr><th>Moral Foundation</th><th>Score</th></tr>
                        </thead>
                        <tbody>
                            {% for anchor, score in condition.raw_scores.items() %}
                            <tr>
                                <td>{{ anchor|replace('_', ' ')|title }}</td>
                                <td>{{ "%.3f"|format(score) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Visualization -->
        <div class="visualization">
            <h2>📊 Visual Analysis</h2>
            <div class="plot-container">
                {{ plot_html|safe }}
            </div>
        </div>

        <!-- Enhanced Statistical Metrics -->
        <div class="statistical-metrics">
            <h2>📈 Statistical Analysis</h2>
            
            {% for method, metrics in statistical_metrics.items() %}
            <div class="metric-card">
                <h3>{{ method|replace('_', ' ')|title }}</h3>
                
                {% if method == 'geometric_similarity' and 'mean_distance' in metrics %}
                <div class="metric-highlight">
                    <strong>Average Distance:</strong> {{ "%.4f"|format(metrics.mean_distance) }}<br>
                    <strong>Range:</strong> {{ "%.4f"|format(metrics.min_distance) }} - {{ "%.4f"|format(metrics.max_distance) }}<br>
                    <strong>Variability:</strong> {{ "%.4f"|format(metrics.std_distance) }}
                </div>
                <div class="metric-explanation">
                    <div class="label">What this means:</div>
                    <div class="text">Models position texts very similarly in the moral framework space. Small distances indicate high agreement on moral characterization.</div>
                </div>
                
                {% elif method == 'dimensional_correlation' and 'correlation_matrix' in metrics %}
                <div class="metric-highlight">
                    <strong>Model Correlation:</strong> {{ "%.3f"|format(metrics.correlation_matrix[0][1]) if metrics.correlation_matrix|length > 1 else 'N/A' }}<br>
                    <strong>Dimensions Analyzed:</strong> {{ metrics.dimensions_analyzed|length if metrics.dimensions_analyzed else 'N/A' }}<br>
                    <strong>Total Comparisons:</strong> {{ metrics.total_comparisons }}
                </div>
                <div class="metric-explanation">
                    <div class="label">What this means:</div>
                    <div class="text">High correlation shows models have similar patterns in moral scoring. Values above 0.7 indicate strong agreement.</div>
                </div>
                
                {% else %}
                <div class="metric-highlight">
                    {{ metrics }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Next Steps -->
        <div class="next-steps">
            <h2>🚀 Next Steps</h2>
            <div class="steps-grid">
                <div class="step-item">
                    <h3>Validate Findings</h3>
                    <p>Test with additional text samples to confirm patterns</p>
                </div>
                
                <div class="step-item">
                    <h3>Explore Differences</h3>
                    <p>Investigate specific cases where models disagree</p>
                </div>
                
                <div class="step-item">
                    <h3>Expand Analysis</h3>
                    <p>Compare with additional AI models or frameworks</p>
                </div>
                
                <div class="step-item">
                    <h3>Apply Results</h3>
                    <p>Use insights for model selection in research projects</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 